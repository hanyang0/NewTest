<!DOCTYPE html>
<html>
    <head>
        <link rel="shortcut icon" href="images/rc.png" type="image/x-icon">
        <title>水利大数据平台</title> 
        <meta charset="utf-8" /> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <!-- 移动设备 viewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,minimal-ui">
        <meta name="author" content=" ">
        <script type="text/javascript" src="lib/include-lib.js" libpath="lib/" include="jquery,font-awesome,bootstrap,layer,haoutil,turf,mars3d"></script>
        <link href="css/style.css" rel="stylesheet" /></head>
        <!-- 图层管理相关处理js -->
        <script type="text/javascript" src="js/graphicManager.js"></script>
        <link href="css/divGraphic1.css" rel="stylesheet" />
    </head>

    <body class="dark" >
        <div class="Loading" ">加载中...</div>

        <style type="text/css">
            .Loading{ background-color: black;font-size: 100px;  width:100%; height:100%; overflow:hidden; position:fixed; text-align: center; top:40%; z-index:10;}
        </style>

        <div id="mars3dContainer" class="mars3d-container" ></div>    
        <div id="viewSL" class="infoview"  style="display:none;"  >
        示例：
        <input type="button" class="btn btn-primary" value="北斗卫星" onclick="showBDWeixinDemo()" />
        <input type="button" class="btn btn-primary" value="火箭发射" onclick="showHuojianDemo()" />
        </div>
        <script type="text/javascript">
            "use script";
            var map;
            $(document).ready(function () {
                if (!mars3d.Util.webglreport()) {
                mars3d.Util.webglerror();
                return;
                }
                initMap();
            });
            function initMap() {
                //创建三维地球场景
                    map = new mars3d.Map("mars3dContainer", {
                    scene: {
                    center: { lat: 30.054604, lng: 108.885436, alt: 17036414, heading: 0, pitch: -90 },
                    showSun: true,
                    showMoon: true,
                    showSkyBox: true,
                    showSkyAtmosphere: false, //关闭球周边的白色轮廓 map.scene.skyAtmosphere = false
                    fog: true,
                    fxaa: true,
                    globe: {
                        showGroundAtmosphere: false, //关闭大气（球表面白蒙蒙的效果）
                        depthTestAgainstTerrain: false,
                        baseColor: "#546a53",
                    },
                    cameraController: {
                        zoomFactor: 3.0,
                        minimumZoomDistance: 1,
                        maximumZoomDistance: 50000000,
                        enableRotate: true,
                        enableZoom: true,
                    },
                },
                control: {
                   // baseLayerPicker: true, //basemaps底图切换按钮
                    homeButton: true, //视角复位按钮
                    sceneModePicker: true, //二三维切换按钮
                    //navigationHelpButton: true, //帮助按钮
                    infoBox: true,
                    selectionIndicator: true, 
                    vrButton: true, //vr模式按钮
                    locationBar: {
                    fps: false,
                    template: '<div>经度:{lng}</div><div>纬度:{lat}</div> <div>海拔：{alt}米 </div><div>Copyright©2021华北水利水电大学刘文锴团队版权所有</div>'
                    },
                    fullscreenButton: true, //全屏按钮
                    defaultContextMenu: true, //右键菜单
                    mouseDownView: true,
                    animation: true,
                    timeline: true,
                    compass: { top: '10px', right: '5px' },
                    distanceLegend: { left: '100px', bottom: '2px' },
                },
                terrain: {
                    url: "//data.mars3d.cn/terrain",
                    show: true,
                },
                basemaps: [
                    {
                        name: "天地图影像",
                        //"ArcGIS影像",
                        //
                        icon: "",
                        type: "tdt",
                        layer: "img_d",
                        key: ["9ae78c51a0a28f06444d541148496e36"],
                        show: true,
                    },
                ],
                });
                //


                //创建DIV数据图层
                var graphicLayer = new mars3d.layer.DivLayer();
                map.addLayer(graphicLayer);
                //图层管理的相关处理，代码在\js\graphicManager.js
                initLayerManager(graphicLayer);
                graphicLayer.unbindPopup();
                var graphic = new mars3d.graphic.DivGraphic({
                    position: Cesium.Cartesian3.fromDegrees(113.790445, 34.780833, 63.5),
                    style: {
                        html: `<div class="marsTiltPanel marsTiltPanel-theme-blue">
                            <div class="marsTiltPanel-wrap">
                                <div class="area">
                                    <div class="arrow-lt"></div>
                                    <div class="b-t"></div>
                                    <div class="b-r"></div>
                                    <div class="b-b"></div>
                                    <div class="b-l"></div>
                                    <div class="arrow-rb"></div>
                                    <div class="label-wrap">
                                        <div class="title">华北水利水电大学刘文锴团队</div>
                                        <div class="label-content">
                                            <div class="data-li">
                                                <div class="data-label">团队介绍：</div>
                                                <div class="data-value"><span class="label-num"></span><span class="label-unit">xxxxxxxxxx</span>
                                                </div>
                                            </div>
                                            <div class="data-li">
                                                <div class="data-label">团队成员：</div>
                                                <div class="data-value"><span class="label-unit"> </span>
                                                </div>
                                            </div>
                                            <div class="data-li">
                                                <div class="data-label1">成员一：</div>
                                                <div>
                                                <img class="dataimage" src="images/OIP-C.png"></img>
                                                <div class="data-value"><span class="label-num"></span><span class="label-unit">介绍内容</span>                                                   
                                                </div>
                                                </div>

                                            <div class="data-li">
                                                <div class="data-label">成员二：</div>
                                                <div>
                                                <img class="dataimage" src="images/OIP-C.png"></img>
                                                <div class="data-value"><span class="label-num"></span><span class="label-unit">介绍内容</span>                                                   
                                                </div>                                               
                                            </div>
                                            <div class="data-li">
                                                <div class="data-label">成员三：</div>
                                                <div>
                                                <img class="dataimage" src="images/OIP-C.png"></img>
                                                <div class="data-value"><span class="label-num"></span><span class="label-unit">介绍内容</span>                                                   
                                                </div>                                               
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="b-t-l"></div>
                                <div class="b-b-r"></div>
                            </div>
                            <div class="arrow" ></div>
                        </div>`,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(1000, 200000), //按视距距离显示
                    },
                    });
                //
                //添加制作团队按钮
                let toolButton = new mars3d.control.ToolButton({
                title: "制作团队",
                icon: "images/cp.png", 
                insertIndex:4, //插入的位置顺序, 1是home按钮后面
                click: (event) => {              
                    if (graphic.isAdded){
                        graphic.remove()     
                    }
                    else{
                        graphicLayer.addGraphic(graphic);
                        
                        map.setCameraView({ lat: 34.771055, lng: 113.789695, alt: 2094, heading: 358, pitch: -57 });       
                    }
                },
                
                });
                map.addControl(toolButton);
                //
                //添加示例按钮
                let toolButtonex = new mars3d.control.ToolButton({
                title: "示例",
                icon: "images/ex.png", 
                insertIndex:5, //插入的位置顺序, 1是home按钮后面
                click: (event) => {
                    var box1=document.getElementById('viewSL');              
                    if (box1.style.display== "none"){
                        box1.style.hidden="";
                        box1.style.display= "block";    
                    }
                    else{
                        box1.style.hidden="hidden";
                        box1.style.display= "none"; 
                        removeLayer();
                        map.setCameraView({ lat: 30.054604, lng: 108.885436, alt: 17036414, heading: 0, pitch: -90 });       
                    }
                },
                
                });
                
                map.addControl(toolButtonex);
                //
                //添加大事件图层  
                var graphic1 = new mars3d.graphic.DivGraphic({
                        position: [113.646031, 34.915779, 72.9],
                        style: {
                        html: `<div class="marsTiltPanel marsTiltPanel-theme-red">
                            <div class="marsTiltPanel-wrap">
                                <div class="area">
                                    <div class="arrow-lt"></div>
                                    <div class="b-t"></div>
                                    <div class="b-r"></div>
                                    <div class="b-b"></div>
                                    <div class="b-l"></div>
                                    <div class="arrow-rb"></div>
                                    <div class="label-wrap">
                                        <div class="title">习近平总书记在黄河流域生态保护和高质量发展座谈会上的讲话</div>
                                        <div class="label-content">
                                            <iframe width="600" 
            height="600" 
            scrolling="yes"
            margin-right: 50px 
            src='http://www.gov.cn/xinwen/2019-10/15/content_5440023.htm'></iframe>
                                        </div>
                                    </div>
                                </div>
                                <div class="b-t-l"></div>
                                <div class="b-b-r"></div>
                            </div>
                            <div class="arrow" ></div>
                        </div>`,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 200000), //按视距距离显示
                        scaleByDistance: new Cesium.NearFarScalar(1000, 1.0, 200000, 0.2),
                        clampToGround: true,
                        },
                      pointerEvents: false, //false时不允许拾取和触发任意鼠标事件，但可以穿透div缩放地球
                    }); 
                    var graphic2 = new mars3d.graphic.DivGraphic({
                        position: [112.56139, 32.987004, 105.3],
                        style: {
                        html: `<div class="marsTiltPanel marsTiltPanel-theme-red">
                            <div class="marsTiltPanel-wrap">
                                <div class="area">
                                    <div class="arrow-lt"></div>
                                    <div class="b-t"></div>
                                    <div class="b-r"></div>
                                    <div class="b-b"></div>
                                    <div class="b-l"></div>
                                    <div class="arrow-rb"></div>
                                    <div class="label-wrap">
                                        <div class="title">习近平总书记主持召开推进南水北调后续工程高质量发展座谈会并发表重要讲话</div>
                                        <div class="label-content">
                                            <iframe width="600" 
            height="600" 
            scrolling="yes"
            margin-right: 50px 
            src='http://www.gov.cn/xinwen/2021-05/14/content_5606498.htm'></iframe>
                                        </div>
                                    </div>
                                </div>
                                <div class="b-t-l"></div>
                                <div class="b-b-r"></div>
                            </div>
                            <div class="arrow" ></div>
                        </div>`,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 200000), //按视距距离显示
                        scaleByDistance: new Cesium.NearFarScalar(1000, 1.0, 200000, 0.2),
                        clampToGround: true,
                        },
                      pointerEvents: false, //false时不允许拾取和触发任意鼠标事件，但可以穿透div缩放地球
                    }); 
                //
                //大事件标签
                    var graphiclab1 = new mars3d.graphic.Popup({
                        position: [113.646031, 34.915779, 72.9],
                        style: {
                        html: `2019年9月18日<br /> 习近平总书记在黄河流域生态保护和高质量发展座谈会上的讲话<br />`,
                        closeButton: false,
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(200000), //按视距距离显示
                        //高亮时的样式
                        highlight: {
                            type: mars3d.EventType.click,
                            className: "mars-popup-highlight",
                        },
                        },
                    });
                    var graphiclab2 = new mars3d.graphic.Popup({
                        position: [112.56139, 32.987004, 105.3],
                        style: {
                        html: `2021年5月14日<br /> 习近平总书记主持召开推进南水北调后续工程高质量发展座谈会并发表重要讲话<br />`,
                        closeButton: false,
                        horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        distanceDisplayCondition: new Cesium.DistanceDisplayCondition(200000), //按视距距离显示
                        //高亮时的样式
                        highlight: {
                            type: mars3d.EventType.click,
                            className: "mars-popup-highlight",
                        },
                        },
                    });
                    graphiclab1.on(mars3d.EventType.click, () => {
                            if (graphic1.isAdded){
                           // graphic1.remove()     
                    }
                    else{
                        graphicLayer.addGraphic(graphic1);
                    }
                    map.setCameraView({"lat":34.918798,"lng":113.670924,"alt":57471,"heading":357,"pitch":-90});       
                    });
                    graphiclab2.on(mars3d.EventType.click, () => {
                            if (graphic2.isAdded){
                           // graphic2.remove()     
                    }
                    else{
                        graphicLayer.addGraphic(graphic2);
                    }  
                    map.setCameraView({"lat":33.081786,"lng":112.609426,"alt":57733,"heading":357,"pitch":-90});       
                    });
                //    
                //添加大事件按钮
                let toolButtonbig = new mars3d.control.ToolButton({
                title: "大事件",
                icon: "images/new.png", 
                insertIndex:3, //插入的位置顺序, 1是home按钮后面
                click: (event) => {              
                    if (graphiclab1.isAdded){
                        graphiclab1.remove()     
                        graphiclab2.remove()     
                    }
                    else{
                        graphicLayer.addGraphic(graphiclab1);
                        graphicLayer.addGraphic(graphiclab2);
                        map.setCameraView({ lat: 35.343197, lng: 110.798275, alt: 6218595, heading: 357, pitch:-90});       
                    }
                },
                
                });
                map.addControl(toolButtonbig);
                //                             
                //添加鹰眼地图功能
                var overviewMap = new mars3d.control.OverviewMap({
                    basemap: {
                        name: "天地图电子",
                        type: "group",
                        layers: [
                        { name: "底图", type: "tdt", layer: "vec_d", key: ["9ae78c51a0a28f06444d541148496e36"] },
                        { name: "注记", type: "tdt", layer: "vec_z", key: ["9ae78c51a0a28f06444d541148496e36"] },
                        ],
                    },
                    rectangle: {
                        color: "#fecd78",
                        opacity: 0.2,
                        outline: 1,
                        outlineColor: "#ff7800",
                    },
                    style: {
                        right: "5px",
                        top: "5px",
                        width: "200px",
                        height: "150px",
                    },
                    });  
                //
                //添加鹰眼地图启用按钮
                let toolButton1 = new mars3d.control.ToolButton({
                title: "鹰眼地图",
                icon: "images/cc.png", 
                insertIndex: 2, //插入的位置顺序, 1是home按钮后面
                click: (event) => {
                    if (overviewMap.isAdded){
                        overviewMap.remove()     
                    }
                    else{
                        map.addControl(overviewMap);
                    }
                },
                });
                map.addControl(toolButton1);
                //
                //添加放大缩小按钮
                var zoom = new mars3d.control.Zoom({
                insertIndex: 1, //插入的位置顺序
                zoomInClass: "fa fa-plus",
                zoomOutClass: "fa fa-minus",
                });
                map.addControl(zoom);
                //
                };
                var czmlLayer;

                function removeLayer() {
                    map.trackedEntity = null;
                    if (czmlLayer) {
                    map.removeLayer(czmlLayer, true);
                    czmlLayer = null;
                    }
                }
                function showBDWeixinDemo() {
                    removeLayer();

                    //更新地球参数
                    map.setSceneOptions({
                        cameraController: {
                        maximumZoomDistance: 500000000,
                        },
                    });
                
                    czmlLayer = new mars3d.layer.CzmlLayer({
                        name: "北斗卫星",
                        url: "satellite.czml",
                        center: { lng: 10, lat: 111.833884, z: 150000000, heading: 0, pitch: -90, roll: 0 },
                        flyTo: true,
                    });
                    map.addLayer(czmlLayer);
                
                    //绑定事件
                    czmlLayer.on(mars3d.EventType.load, function (event) {
                        console.log("数据加载完成", event);
                    
                        initTree(event.list);
                    });
                    czmlLayer.on(mars3d.EventType.click, function (event) {
                        console.log("单击了图层", event);
                    });
                }
                function showHuojianDemo() {
                    removeLayer();

                   // map.basemap = "ArcGIS影像";

                    czmlLayer = new mars3d.layer.CzmlLayer({
                        name: "火箭发射",
                        url: "space.czml",
                        flyTo: true,
                    });
                    map.addLayer(czmlLayer);
                
                    //绑定事件
                    czmlLayer.on(mars3d.EventType.load, function (event) {
                        console.log("数据加载完成", event);
                        map.setCameraView({ lat: 28.561843, lng: -80.577575, alt: 630, heading: 359, pitch: -85 });
                    
                      //火星发射时，锁定火箭模型对象
                    map.trackedEntity = event.dataSource.entities.getById("Vulcan");
                    
                        initTree(event.list);
                    });
                    czmlLayer.on(mars3d.EventType.click, function (event) {
                        console.log("单击了图层", event);
                    });
                    }

        </script>
        <script type="text/javascript">
        $(function(){
            setTimeout(function(){
                $(".Loading").hide();
				;
			},1000);
	})
        </script>
    </body>
</html>
